<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Banco Quantum</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --sidebar-bg: #1f244c;
            --main-bg: #ffffff;
            --accent: #78b2cb;
            --text-dark: #0f1724;
            --text-light: #ffffff;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }

        body, html {
            margin: 0;
            height: 100%;
        }

        body {
            display: flex;
            background: var(--main-bg);
            color: var(--text-dark);
        }

        /* Sidebar */
        #sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            transition: width 0.3s;
            height: 100vh; /* ocupa toda a altura da tela */
            overflow-y: auto;
        }

            #sidebar h2 {
                text-align: center;
                padding: 15px 0;
                margin: 0;
                font-size: 18px;
                border-bottom: 1px solid rgba(255,255,255,0.2);
                position: relative;
            }

        #toggleSidebar {
            position: absolute;
            right: 10px;
            top: 10px;
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
        }

            .nav-item:hover, .nav-item.active {
                background: var(--accent);
            }

        .topic {
            padding: 10px 20px;
            color: #bbb;
            font-size: 13px;
            text-transform: uppercase;
            margin-top: 10px;
        }

        /* Main */
        #main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            transition: margin-left 0.3s;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }

            .content-section.active {
                display: block;
            }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        textarea, input, select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
            resize: vertical;
        }

        button.submit-btn, button.open-kids-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            background: var(--accent);
            color: var(--text-light);
            cursor: pointer;
            font-weight: bold;
            margin-top: 5px;
        }

            button.submit-btn:hover, button.open-kids-btn:hover {
                opacity: 0.9;
            }

        #kidsForm {
            margin-top: 10px;
            display: none;
        }

        #extratoContainer {
            border: 1px solid #ccc;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            margin-top: 15px;
            background: #f7f7f7;
        }

        #extratoList {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: center;
            color: #777;
        }

        #saldoAtual {
            font-size: 1.4em;
            font-weight: bold;
            color: #1f244c;
        }

        #greeting {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #1f244c;
        }

        /* CDB */
        #cdbContainer {
            background: #f5f8fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        #cdbChartContainer {
            margin-top: 20px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

            .row > * {
                flex: 1;
            }

        .small {
            flex: 0 0 160px;
        }

        .muted {
            color: #666;
            font-size: 0.95em;
        }

        /* Conta Kids (estilo integrado) */
        #contaKidsContainer {
            background: #f5f8fa;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .kids-header {
            font-weight: 700;
            margin-bottom: 6px;
        }

        .msg-anim {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 6px;
            background: #d1fae5;
            color: #065f46;
            transform: translateY(0);
            opacity: 0;
            transition: transform .35s ease, opacity .35s ease;
        }

            .msg-anim.show {
                transform: translateY(-6px);
                opacity: 1;
            }

        /* === Cartões === */
        .cards-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .card-item {
            background: #f5f7fb;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            padding: 15px;
            text-align: center;
            width: 220px;
            cursor: pointer;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

            .card-item:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }

            .card-item img {
                width: 100%;
                border-radius: 10px;
                margin-bottom: 8px;
            }

        /* Popup Cartões */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .popup {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            animation: fadeIn 0.3s ease;
        }

        .popup-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        #emprestimoResumo p {
            margin: 4px 0;
        }

        .faq-item {
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        .faq-question {
            font-weight: bold;
            cursor: pointer;
            position: relative;
            padding-right: 20px;
        }

            .faq-question::after {
                content: "+";
                position: absolute;
                right: 0;
                top: 0;
                font-weight: bold;
            }

            .faq-question.active::after {
                content: "-";
            }

        .faq-answer {
            display: none;
            padding: 8px 0 0 0;
            color: #555;
        }


    </style>
</head>
<body>

    <div id="sidebar">
        <h2>
            Banco Quantum
            <button id="toggleSidebar">☰</button>
        </h2>
        <div class="topic">Pagina Principal</div>
        <div class="nav-item active" data-target="saldo">Saldo e Extrato</div>
        <div class="nav-item" data-target="transferencias">Transferências</div>
        <div class="nav-item" data-target="cartoes">Cartões</div>
        <div class="nav-item" data-target="cdb">CDB</div>
        <div class="nav-item" data-target="emprestimos">Empréstimos</div>
        <div class="nav-item" data-target="contaKids">Conta Kids</div>

        <div class="topic">Informações</div>
        <div class="nav-item" data-target="sobreBanco">Sobre o Banco</div>
        <div class="nav-item" data-target="seguranca">Segurança</div>
        <div class="nav-item" data-target="termos">Termos e Condições</div>
        <div class="nav-item" data-target="contatoRapido">Contato Rápido</div>

        <div class="topic">Suporte</div>
        <div class="nav-item" data-target="duvidas">Dúvidas Frequentes</div>
        <div class="nav-item" data-target="contato">Entrar em Contato</div>
    </div>

    <div id="main">
        <!-- Seções existentes -->
        <div id="saldo" class="content-section active">
            <h2 id="greeting">Olá, Usuário</h2>
            <p>Saldo atual: R$ <span id="saldoAtual">30.00</span></p>
            <div id="extratoContainer"><p>Nenhum extrato registrado.</p></div>
        </div>

        <!-- CDB -->
        <div id="cdb" class="content-section">
            <h2>Investimento em CDB</h2>
            <div id="cdbContainer">
                <p><strong>CDI atual:</strong> 13.65% a.a</p>
                <p><strong>Rendimento CDB:</strong> 110% do CDI</p>
                <p><strong>Saldo investido:</strong> R$ <span id="cdbSaldo">0.00</span></p>
                <p><strong>Rendimento acumulado:</strong> R$ <span id="cdbLucro">0.00</span></p>

                <input type="number" id="valorCdb" placeholder="Valor para investir (R$)">
                <button id="investirCdb" class="submit-btn">Investir</button>
                <p id="cdbMsg"></p>

                <div style="margin-top:12px;">
                    <label class="muted">Simular crescimento</label>
                    <div class="row" style="margin-top:6px;">
                        <select id="simAnos" class="small">
                            <option value="1">1 ano</option>
                            <option value="2">2 anos</option>
                            <option value="3">3 anos</option>
                            <option value="4">4 anos</option>
                            <option value="5">5 anos</option>
                            <option value="6">6 anos</option>
                            <option value="7">7 anos</option>
                            <option value="8">8 anos</option>
                            <option value="9">9 anos</option>
                            <option value="10">10 anos</option>
                        </select>
                        <button id="simularBtn" class="submit-btn small">Simular</button>

                        <!-- resgate -->
                        <input type="number" id="valorResgatar" placeholder="Valor para resgatar (vazio = total)">
                        <button id="resgatarBtn" class="submit-btn small">Resgatar</button>
                    </div>
                    <p id="valorApos" class="muted" style="margin-top:8px;">Valor aproximado após X anos: R$ <span id="valorAposSpan">0.00</span></p>
                </div>
            </div>

            <div id="cdbChartContainer">
                <h3>Simulação de Crescimento</h3>
                <canvas id="cdbChart" height="100"></canvas>
            </div>
        </div>

        <!-- Outras seções (inalteradas) -->
        <div id="transferencias" class="content-section">
            <h2>Transferências</h2>
            <form id="transferForm">
                <input type="email" placeholder="Email do destinatário" required>
                <input type="number" placeholder="Valor" required>
                <button type="submit" class="submit-btn">Enviar</button>
            </form>
            <p id="transferStatus"></p>
        </div>

        <div id="cartoes" class="content-section">
            <h2>Cartões</h2>
            <div class="cards-container">
                <div class="card-item" data-card="essencial">
                    <img src="essencial.png" alt="Cartão Essencial">
                    <h3>Essencial</h3>
                </div>
                <div class="card-item" data-card="premium">
                    <img src="premium.png" alt="Cartão Premium">
                    <h3>Premium</h3>
                </div>
                <div class="card-item" data-card="kids">
                    <img src="kidr.png" alt="Cartão Kids">
                    <h3>Kids</h3>
                </div>
            </div>

            <!-- Popup -->
            <div id="popupCartao" class="popup-overlay">
                <div class="popup">
                    <h3 id="popupTitulo">Título do Cartão</h3>
                    <p id="popupDescricao">Descrição aqui...</p>
                    <div class="popup-buttons">
                        <button id="confirmarSim" class="submit-btn">Sim</button>
                        <button id="confirmarNao" class="submit-btn" style="background:#e11d48">Não</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="investimentos" class="content-section"><h2>Investimentos</h2></div>
        <div id="emprestimos" class="content-section">

            <div id="emprestimoResumo">
                <p id="emprestimoStatus">Parcelas pagas: 0 / 0</p>
                <button id="pagarParcelaBtn" class="submit-btn">Pagar Próxima Parcela</button>
            </div>

            <h3>Simulação de Empréstimo</h3>
            <input type="number" id="valorSimEmprestimo" placeholder="Valor do empréstimo (R$)">
            <select id="parcelasSim">
                <option value="1">1 mês</option>
                <option value="3">3 meses</option>
                <option value="6">6 meses</option>
                <option value="12">12 meses</option>
                <option value="24">24 meses</option>
            </select>
            <button id="simularEmprestimoBtn" class="submit-btn">Simular Empréstimo</button>
            <button id="confirmarEmprestimoBtn" class="submit-btn" disabled>Confirmar Empréstimo</button>
            <canvas id="simEmprestimoChart" height="100" style="margin-top:12px;"></canvas>
            <p>Saldo da conta: R$ <span id="saldoConta">0.00</span></p>


        </div>
        <!-- CONTA KIDS: Abaixo é onde inseri toda a funcionalidade pedida -->
        <div id="contaKids" class="content-section">
            <h2>Conta Kids</h2>
            <p>Crie uma conta infantil e configure a mesada automática.</p>

            <div id="contaKidsContainer">
                <div class="kids-header">Criar Conta Kids</div>

                <form id="kidsFormSimbolico">
                    <input type="text" id="nomeCrianca" placeholder="Nome da criança" required>
                    <input type="number" id="idadeCrianca" placeholder="Idade" min="1" max="17" required>
                    <select id="relacao">
                        <option value="">Relação com a criança</option>
                        <option value="Pai">Pai</option>
                        <option value="Mãe">Mãe</option>
                        <option value="Responsável">Responsável</option>
                    </select>
                    <input type="number" id="depositoInicial" placeholder="Depósito inicial (opcional, R$)" min="0" step="0.01">
                    <button type="submit" class="submit-btn">Criar Conta Kids</button>
                </form>

                <div id="kidsConfig" style="display:none; margin-top:12px;">
                    <div class="kids-header">Configurar Mesada</div>
                    <input type="number" id="valorMesada" placeholder="Valor da mesada (R$)" min="0.01" step="0.01">
                    <select id="frequenciaMesada">
                        <option value="dia">Todo dia</option>
                        <option value="semana">Toda semana</option>
                        <option value="mes">Todo mês</option>
                    </select>
                    <div style="display:flex; gap:8px; margin-top:8px;">
                        <button id="salvarMesada" class="submit-btn" style="flex:1">Salvar Mesada</button>
                        <button id="desativarMesada" class="submit-btn" style="flex:1; background:#e11d48">Desativar</button>
                    </div>
                    <p id="msgMesada" style="margin-top:8px;"></p>
                </div>

                <div id="kidsResumo" style="margin-top:12px; display:none; border:1px solid #ddd; padding:10px; border-radius:8px; background:#fff;">
                    <div class="kids-header">Resumo Conta Kids</div>
                    <p id="resumoTexto">—</p>
                    <p id="resumoMesada" class="muted">—</p>
                    <p id="proximaMesada" class="muted">—</p>
                    <div id="animMsg" class="msg-anim" style="display:inline-block; margin-top:8px;"></div>
                </div>
            </div>
        </div>

        <div id="duvidas" class="content-section">
            <h2>Dúvidas Frequentes</h2>
            <div class="faq-item">
                <div class="faq-question">Como faço para abrir uma Conta Kids?</div>
                <div class="faq-answer">Para abrir uma Conta Kids, vá até a seção "Conta Kids" no dashboard, preencha os dados da criança e configure a mesada conforme desejado.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Qual é o prazo para o CDB render?</div>
                <div class="faq-answer">O CDB rende diariamente, mas o cálculo de rendimento mostrado na simulação considera o período anual conforme a taxa selecionada.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Como funciona o pagamento de parcelas do empréstimo?</div>
                <div class="faq-answer">Você pode pagar cada parcela manualmente clicando em "Pagar Próxima Parcela". O saldo será debitado automaticamente da sua conta principal.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Posso investir mais de uma vez no CDB?</div>
                <div class="faq-answer">Sim! Você pode investir quantas vezes quiser, desde que tenha saldo disponível em sua conta.</div>
            </div>
        </div>

        <div id="contato" class="content-section"><h2>Entrar em Contato</h2></div>

        <div id="sobreBanco" class="content-section">
            <h2>Sobre o Banco Quantum</h2>
            <p>O Banco Quantum é uma instituição digital inovadora, oferecendo soluções financeiras inteligentes, seguras e acessíveis a todos os clientes.</p>
        </div>

        <div id="seguranca" class="content-section">
            <h2>Segurança</h2>
            <ul>
                <li>Não compartilhe sua senha com ninguém.</li>
                <li>Ative a autenticação em dois fatores para mais proteção.</li>
                <li>Verifique sempre os e-mails ou mensaingens antes de clicar em links.</li>
            </ul>
        </div>

        <div id="termos" class="content-section">
            <h2>Termos e Condições</h2>
            <p>Leia atentamente nossos termos e condições para entender seus direitos e responsabilidades ao usar os serviços do Banco Quantum.</p>
        </div>

        <div id="contatoRapido" class="content-section">
            <h2>Contato Rápido</h2>
            <p>Email: suporte@bancoquantum.com</p>
            <p>Telefone: (11) 4002-8922</p>
            <p>Chat: disponível no app 24h</p>
        </div>


    </div>

    <script>
        // Alternar abas (mantive seu comportamento)
        const navItems = document.querySelectorAll('.nav-item');
        const sections = document.querySelectorAll('.content-section');
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                const target = item.dataset.target;
                sections.forEach(sec => sec.classList.remove('active'));
                document.getElementById(target).classList.add('active');
            });
        });

        // Sidebar toggle
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('toggleSidebar');
        toggleBtn.addEventListener('click', () => {
            sidebar.style.width = sidebar.style.width === '60px' ? '220px' : '60px';
        });

        // Saudação e Saldo (mantive suas chaves)
        const greetingEl = document.getElementById('greeting');
        const userName = localStorage.getItem('userName') || 'Usuário';
        greetingEl.textContent = `Olá, ${userName}`;

        const saldoEl = document.getElementById('saldoAtual');
        let saldo = parseFloat(localStorage.getItem('userBalance')) || 100;
        saldoEl.textContent = saldo.toFixed(2);

        // --- CDB funcional (mantive tudo) ---
        let cdbSaldo = parseFloat(localStorage.getItem('cdbSaldo')) || 0;
        let cdbLucro = parseFloat(localStorage.getItem('cdbLucro')) || 0;
        const cdbSaldoEl = document.getElementById('cdbSaldo');
        const cdbLucroEl = document.getElementById('cdbLucro');
        const valorCdbEl = document.getElementById('valorCdb');
        const cdbMsgEl = document.getElementById('cdbMsg');
        const cdi = 13.65 / 100;
        const rendimentoAnual = cdi * 1.10;
        const rendimentoDiario = rendimentoAnual / 365;

        cdbSaldoEl.textContent = cdbSaldo.toFixed(2);
        cdbLucroEl.textContent = cdbLucro.toFixed(2);

        // Extrato (simples)
        function appendExtrato(text) {
            const extrato = JSON.parse(localStorage.getItem('extrato') || '[]');
            extrato.push(`${new Date().toLocaleString()}: ${text}`);
            localStorage.setItem('extrato', JSON.stringify(extrato));
            renderExtrato();
        }
        function renderExtrato() {
            const extratoContainer = document.getElementById('extratoContainer');
            const extrato = JSON.parse(localStorage.getItem('extrato') || '[]');
            if (!extratoContainer) return;
            if (extrato.length === 0) {
                extratoContainer.innerHTML = '<p>Nenhum extrato registrado.</p>';
            } else {
                extratoContainer.innerHTML = '<ul id="extratoList"></ul>';
                const list = document.getElementById('extratoList');
                extrato.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    list.appendChild(li);
                });
            }
        }
        renderExtrato();

        // Gráfico (Chart.js)
        const ctx = document.getElementById('cdbChart').getContext('2d');
        const labels = [];
        const data = [];
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    label: 'Saldo CDB (R$)',
                    data,
                    borderColor: '#78b2cb',
                    fill: false,
                    tension: 0.1,
                    pointRadius: 3
                }]
            },
            options: {
                scales: { y: { beginAtZero: true } },
                animation: { duration: 500 }
            }
        });

        function pushLivePoint() {
            const time = new Date().toLocaleTimeString();
            labels.push(time);
            data.push(parseFloat(cdbSaldo.toFixed(2)));
            if (labels.length > 10) { labels.shift(); data.shift(); }
            chart.update();
        }

        document.getElementById('investirCdb').addEventListener('click', () => {
            const valor = parseFloat(valorCdbEl.value);
            if (isNaN(valor) || valor <= 0) {
                cdbMsgEl.textContent = 'Digite um valor válido.';
                return;
            }
            if (valor > saldo) {
                cdbMsgEl.textContent = 'Saldo insuficiente.';
                return;
            }

            saldo -= valor;
            cdbSaldo += valor;
            localStorage.setItem('userBalance', saldo);
            localStorage.setItem('cdbSaldo', cdbSaldo);
            saldoEl.textContent = saldo.toFixed(2);
            cdbSaldoEl.textContent = cdbSaldo.toFixed(2);
            cdbMsgEl.textContent = 'Investimento aplicado com sucesso!';
            appendExtrato(`Aplicação CDB de R$ ${valor.toFixed(2)}`);
            valorCdbEl.value = '';
        });

        setInterval(() => {
            if (cdbSaldo > 0) {
                const ganho = cdbSaldo * rendimentoDiario;
                cdbSaldo += ganho;
                cdbLucro += ganho;
                localStorage.setItem('cdbSaldo', cdbSaldo);
                localStorage.setItem('cdbLucro', cdbLucro);
                cdbSaldoEl.textContent = cdbSaldo.toFixed(2);
                cdbLucroEl.textContent = cdbLucro.toFixed(2);
                pushLivePoint();
            }
        }, 5000);

        // SIMULAÇÃO FIXA
        const simAnosEl = document.getElementById('simAnos');
        const simularBtn = document.getElementById('simularBtn');
        const valorAposSpan = document.getElementById('valorAposSpan');

        function calcularFuturo(principal, anos, taxaAnual) {
            return principal * Math.pow(1 + taxaAnual, anos);
        }

        simularBtn.addEventListener('click', () => {
            const anos = parseInt(simAnosEl.value, 10) || 1;
            const principal = cdbSaldo;
            const taxa = rendimentoAnual;
            const pontos = [];
            const labelsSim = [];
            for (let y = 0; y <= anos; y++) {
                const val = calcularFuturo(principal, y, taxa);
                pontos.push(parseFloat(val.toFixed(2)));
                labelsSim.push(`${y}a`);
            }
            const valorFinal = pontos[pontos.length - 1] || principal;
            valorAposSpan.textContent = valorFinal.toFixed(2);
            chart.data.labels = [];
            chart.data.datasets[0].data = [];
            chart.update();
            let idx = 0;
            const totalDuration = Math.min(3500, 300 * anos + 400);
            const stepDelay = Math.max(150, Math.floor(totalDuration / Math.max(1, anos)));
            const anim = setInterval(() => {
                if (idx > anos) { clearInterval(anim); return; }
                chart.data.labels.push(labelsSim[idx]);
                chart.data.datasets[0].data.push(pontos[idx]);
                chart.update();
                idx++;
            }, stepDelay);
        });

        // RESGATE
        const valorResgatarEl = document.getElementById('valorResgatar');
        const resgatarBtn = document.getElementById('resgatarBtn');

        resgatarBtn.addEventListener('click', () => {
            let valor = parseFloat(valorResgatarEl.value);
            if (isNaN(valor) || valor <= 0) { valor = cdbSaldo; }
            if (valor > cdbSaldo) {
                cdbMsgEl.textContent = 'Valor de resgate maior que o saldo do CDB.';
                return;
            }
            cdbSaldo -= valor;
            saldo += valor;
            localStorage.setItem('cdbSaldo', cdbSaldo);
            localStorage.setItem('userBalance', saldo);
            cdbSaldoEl.textContent = cdbSaldo.toFixed(2);
            saldoEl.textContent = saldo.toFixed(2);
            appendExtrato(`Resgate CDB de R$ ${valor.toFixed(2)} (transferido para conta)`);
            cdbMsgEl.textContent = `Resgate de R$ ${valor.toFixed(2)} realizado com sucesso.`;
            valorResgatarEl.value = '';
            pushLivePoint();
        });

        // inicializa gráfico salvo
        (function initChartWithLocalData() {
            const savedLabels = JSON.parse(localStorage.getItem('cdb_chart_labels') || 'null');
            const savedData = JSON.parse(localStorage.getItem('cdb_chart_data') || 'null');
            if (savedLabels && savedData) {
                chart.data.labels = savedLabels;
                chart.data.datasets[0].data = savedData;
                chart.update();
            } else {
                if (cdbSaldo > 0) pushLivePoint();
            }
        })();

        const originalUpdate = chart.update.bind(chart);
        chart.update = function () {
            originalUpdate();
            try {
                localStorage.setItem('cdb_chart_labels', JSON.stringify(chart.data.labels));
                localStorage.setItem('cdb_chart_data', JSON.stringify(chart.data.datasets[0].data));
            } catch (e) { }
        };

        // ============================
        // CONTA KIDS - IMPLEMENTAÇÃO
        // ============================
        const kidsForm = document.getElementById('kidsFormSimbolico');
        const kidsConfig = document.getElementById('kidsConfig');
        const kidsResumo = document.getElementById('kidsResumo');
        const resumoTexto = document.getElementById('resumoTexto');
        const resumoMesada = document.getElementById('resumoMesada');
        const proximaMesadaP = document.getElementById('proximaMesada');
        const msgMesada = document.getElementById('msgMesada');
        const animMsg = document.getElementById('animMsg');
        const desativarBtn = document.getElementById('desativarMesada');

        // Helper: calcula próxima data conforme frequência
        function calcularProximaData(fromTs, freq) {
            const d = new Date(fromTs);
            if (freq === 'dia') {
                d.setDate(d.getDate() + 1);
            } else if (freq === 'semana') {
                d.setDate(d.getDate() + 7);
            } else {
                // mês
                d.setMonth(d.getMonth() + 1);
            }
            return d.getTime();
        }

        // Carregar conta kids se existir
        function carregarContaKidsUI() {
            const conta = JSON.parse(localStorage.getItem('kidsConta') || 'null');
            const mesada = JSON.parse(localStorage.getItem('kidsMesada') || 'null');
            const nextDue = parseInt(localStorage.getItem('kidsNextDue') || '0', 10);

            if (conta) {
                kidsForm.style.display = 'none';
                kidsConfig.style.display = 'block';
                kidsResumo.style.display = 'block';
                resumoTexto.textContent = `${conta.nome}, ${conta.idade} anos (${conta.relacao})`;
                if (mesada) {
                    resumoMesada.textContent = `Mesada: R$ ${mesada.valor.toFixed(2)} — ${mesada.freq === 'dia' ? 'diária' : mesada.freq === 'semana' ? 'semanal' : 'mensal'}`;
                    if (nextDue && !isNaN(nextDue)) {
                        proximaMesadaP.textContent = `Próxima mesada: ${new Date(nextDue).toLocaleString()}`;
                    } else {
                        proximaMesadaP.textContent = 'Próxima mesada: não agendada';
                    }
                } else {
                    resumoMesada.textContent = 'Mesada ainda não configurada.';
                    proximaMesadaP.textContent = 'Próxima mesada: —';
                }
            } else {
                kidsForm.style.display = 'block';
                kidsConfig.style.display = 'none';
                kidsResumo.style.display = 'none';
            }
        }

        // Função para mostrar animação de mensagem
        function showAnimMessage(text, success = true) {
            animMsg.textContent = text;
            animMsg.style.background = success ? '#d1fae5' : '#fee2e2';
            animMsg.style.color = success ? '#065f46' : '#7f1d1d';
            animMsg.classList.add('show');
            setTimeout(() => animMsg.classList.remove('show'), 2500);
        }

        // Criar conta kids (simbólica). Opcional: depósito inicial transfere do saldo principal
        kidsForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const nome = document.getElementById('nomeCrianca').value.trim();
            const idade = document.getElementById('idadeCrianca').value.trim();
            const relacao = document.getElementById('relacao').value;
            const deposito = parseFloat(document.getElementById('depositoInicial').value) || 0;

            if (!nome || !idade || !relacao) {
                return alert('Preencha todos os campos da conta Kids.');
            }

            // se houver depósito inicial e saldo suficiente, transfere do saldo principal para "kidsBalance"
            let kidsBalance = 0;
            if (deposito > 0) {
                if (deposito > saldo) {
                    return alert('Saldo insuficiente para o depósito inicial.');
                }
                saldo -= deposito;
                localStorage.setItem('userBalance', saldo);
                saldoEl.textContent = saldo.toFixed(2);
                appendExtrato(`Depósito inicial Conta Kids: R$ ${deposito.toFixed(2)} (transferido da conta principal)`);
                kidsBalance = deposito;
                localStorage.setItem('kidsBalance', kidsBalance);
            } else {
                localStorage.setItem('kidsBalance', 0);
            }

            const conta = { nome, idade, relacao, createdAt: Date.now() };
            localStorage.setItem('kidsConta', JSON.stringify(conta));

            // não agenda mesada ainda — aguarda configuração
            carregarContaKidsUI();
            showAnimMessage('Conta Kids criada com sucesso!');
        });

        // Salvar mesada (agenda a primeira execução para agora + intervalo)
        document.getElementById('salvarMesada').addEventListener('click', () => {
            const valor = parseFloat(document.getElementById('valorMesada').value);
            const freq = document.getElementById('frequenciaMesada').value;
            if (isNaN(valor) || valor <= 0 || !['dia', 'semana', 'mes'].includes(freq)) {
                msgMesada.textContent = 'Preencha valor e frequência válidos.';
                return;
            }

            const mesada = { valor: parseFloat(valor.toFixed(2)), freq };
            localStorage.setItem('kidsMesada', JSON.stringify(mesada));

            // define próxima data: agendamos a primeira para daqui a 5s (para teste) OU para agora.
            // Para comportamento real, definimos próxima para agora + intervalo. Aqui definimos para agora.
            const now = Date.now();
            const next = calcularProximaData(now - 1, freq); // próxima ocorrência
            localStorage.setItem('kidsNextDue', String(next));
            msgMesada.textContent = '';
            showAnimMessage('Mesada configurada com sucesso!');
            appendExtrato(`Mesada configurada: R$ ${mesada.valor.toFixed(2)} - ${mesada.freq}`);

            carregarContaKidsUI();
        });

        // Desativar mesada (remove agendamento)
        desativarBtn.addEventListener('click', () => {
            localStorage.removeItem('kidsMesada');
            localStorage.removeItem('kidsNextDue');
            msgMesada.textContent = 'Mesada desativada.';
            showAnimMessage('Mesada desativada.', false);
            carregarContaKidsUI();
        });

        // Função que aplica a mesada quando a data vencer
        function tentarAplicarMesada() {
            const mesada = JSON.parse(localStorage.getItem('kidsMesada') || 'null');
            let nextDue = parseInt(localStorage.getItem('kidsNextDue') || '0', 10);
            if (!mesada || !nextDue) return;

            const now = Date.now();
            // se chegou ou passou da data, aplicar quantas vezes necessário (por se ficou vários períodos)
            if (now >= nextDue) {
                // calcula quantas ocorrências passaram
                let occur = 0;
                let tempNext = nextDue;
                while (now >= tempNext && occur < 1000) { // safety cap
                    occur++;
                    tempNext = calcularProximaData(tempNext, mesada.freq);
                }
                // aplicamos uma vez por cada ocorrência (normalmente será 1)
                for (let i = 0; i < occur; i++) {
                    // adiciona mesada ao saldo principal
                    saldo += mesada.valor;
                    localStorage.setItem('userBalance', saldo);
                    saldoEl.textContent = saldo.toFixed(2);
                    appendExtrato(`Mesada recebida: R$ ${mesada.valor.toFixed(2)}`);
                    showAnimMessage(`Mesada de R$ ${mesada.valor.toFixed(2)} creditada!`);
                }
                // salva próximo vencimento
                localStorage.setItem('kidsNextDue', String(tempNext));
                carregarContaKidsUI();
            }
        }

        // checa a cada 5 segundos se a mesada venceu (para testes rápidos; em produção poderia ser a cada minuto)
        setInterval(tentarAplicarMesada, 5000);
        // também rodar ao carregar
        tentarAplicarMesada();

        // inicializa UI de kids ao abrir
        carregarContaKidsUI();

        // === Sistema de Cartões ===
        const cardsInfo = {
            essencial: {
                titulo: "Cartão Essencial",
                descricao: `Cashback de 0,5% em todas as compras, zero anuidade e programa de proteção de compras.`
                     
                 
            },
            premium: {
                titulo: "Cartão Premium",
                descricao: "Cashback de 1,5% em todas as compras, programa de pontos exclusivo, programa de proteção de compras, poncierge 24h, seguro viagem internacional, acesso VIP em aeorportos."
            },
            kids: {
                titulo: "Cartão Kids",
                descricao: "Cashback de 0,5%, crontrole de gastos, zero anuidade, programa de proteção de compras, escolha de cor e monitoramento"
            }
        };

        const popup = document.getElementById("popupCartao");
        const popupTitulo = document.getElementById("popupTitulo");
        const popupDescricao = document.getElementById("popupDescricao");
        const btnSim = document.getElementById("confirmarSim");
        const btnNao = document.getElementById("confirmarNao");

        document.querySelectorAll(".card-item").forEach(card => {
            card.addEventListener("click", () => {
                const tipo = card.dataset.card;
                const info = cardsInfo[tipo];
                popupTitulo.textContent = info.titulo;
                popupDescricao.textContent = info.descricao;
                popup.style.display = "flex";
            });
        });

        btnNao.addEventListener("click", () => {
            popup.style.display = "none";
        });

        btnSim.addEventListener("click", () => {
            alert("Pedido confirmado! Seu cartão será analisado em breve.");
            popup.style.display = "none";
        });

        popup.addEventListener("click", (e) => {
            if (e.target === popup) popup.style.display = "none";
        });

        let simEmprestimoChart = null;

        document.getElementById('simularEmprestimoBtn').addEventListener('click', () => {
            const valor = parseFloat(document.getElementById('valorSimEmprestimo').value);
            const parcelas = parseInt(document.getElementById('parcelasSim').value, 10);

            if (isNaN(valor) || valor <= 0) return alert('Valor do empréstimo inválido.');
            if (isNaN(parcelas) || parcelas <= 0) return alert('Número de parcelas inválido.');

            const juros = 0.078; // 7,8% ao mês
            const parcelaValor = valor * (juros * Math.pow(1 + juros, parcelas)) / (Math.pow(1 + juros, parcelas) - 1);

            const totalPago = [];
            const labels = [];
            let acumulado = 0;
            for (let m = 1; m <= parcelas; m++) {
                acumulado += parcelaValor;
                totalPago.push(parseFloat(acumulado.toFixed(2)));
                labels.push(`Mês ${m}`);
            }

            const ctxEmprestimo = document.getElementById('simEmprestimoChart').getContext('2d');
            if (!simEmprestimoChart) {
                simEmprestimoChart = new Chart(ctxEmprestimo, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Total Pago (R$)',
                            data: totalPago,
                            borderColor: '#78b2cb',
                            fill: false,
                            tension: 0.1,
                            pointRadius: 3
                        }]
                    },
                    options: {
                        scales: { y: { beginAtZero: true } },
                        animation: { duration: 500 }
                    }
                });
            } else {
                simEmprestimoChart.data.labels = labels;
                simEmprestimoChart.data.datasets[0].data = totalPago;
                simEmprestimoChart.update();
            }

            // Habilita botão para confirmar empréstimo
            document.getElementById('confirmarEmprestimoBtn').disabled = false;

        // Botão confirmar empréstimo
        document.getElementById('confirmarEmprestimoBtn').addEventListener('click', () => {
            const valor = parseFloat(document.getElementById('valorSimEmprestimo').value);
            const parcelas = parseInt(document.getElementById('parcelasSim').value, 10);
            if (isNaN(valor) || valor <= 0) return alert('Valor do empréstimo inválido.');
            if (isNaN(parcelas) || parcelas <= 0) return alert('Número de parcelas inválido.');

            const juros = 0.078; // 7,8% ao mês
            const parcelaValor = valor * (juros * Math.pow(1 + juros, parcelas)) / (Math.pow(1 + juros, parcelas) - 1);

            const emprestimo = {
                total: valor,
                parcelas,
                parcelaValor: parseFloat(parcelaValor.toFixed(2)),
                pagas: 0
            };

            // Salva no localStorage
            localStorage.setItem('emprestimo', JSON.stringify(emprestimo));

            // Adiciona saldo
            saldo += valor;
            localStorage.setItem('userBalance', saldo);
            saldoEl.textContent = saldo.toFixed(2);
            appendExtrato(`Empréstimo de R$ ${valor.toFixed(2)} confirmado.`);

            document.getElementById('valorSimEmprestimo').value = '';
            document.getElementById('confirmarEmprestimoBtn').disabled = true;

            // Atualiza status inicial da parcela
            document.getElementById('emprestimoStatus').textContent =
                `Parcelas pagas: ${emprestimo.pagas} / ${emprestimo.parcelas}`;

            alert(`Empréstimo de R$ ${valor.toFixed(2)} adicionado à sua conta!`);
        });

        });

        document.getElementById('pagarParcelaBtn').addEventListener('click', () => {
            const emprestimo = JSON.parse(localStorage.getItem('emprestimo') || 'null');
            if (!emprestimo) return alert('Não há empréstimos ativos.');

            if (emprestimo.pagas >= emprestimo.parcelas) {
                alert('Todas as parcelas já foram pagas!');
                return;
            }

            if (saldo < emprestimo.parcelaValor) {
                alert('Saldo insuficiente para pagar a parcela!');
                return;
            }

            // Deduz do saldo
            saldo -= emprestimo.parcelaValor;
            saldoEl.textContent = saldo.toFixed(2);
            appendExtrato(`Parcela do empréstimo paga: R$ ${emprestimo.parcelaValor.toFixed(2)}`);

            // Atualiza parcelas pagas
            emprestimo.pagas += 1;
            localStorage.setItem('emprestimo', JSON.stringify(emprestimo));

            // Atualiza status
            document.getElementById('emprestimoStatus').textContent =
                `Parcelas pagas: ${emprestimo.pagas} / ${emprestimo.parcelas}`;

            if (emprestimo.pagas === emprestimo.parcelas) {
                alert('Empréstimo totalmente quitado!');
            }
        });

        document.querySelectorAll('.faq-question').forEach(q => {
            q.addEventListener('click', () => {
                q.classList.toggle('active');
                const answer = q.nextElementSibling;
                if (answer.style.display === 'block') {
                    answer.style.display = 'none';
                } else {
                    answer.style.display = 'block';
                }
            });
        });


    </script>

</body>
</html>
